<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanva Botanicals Quote Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .calculator {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        /* Sidebar Mode - Compact */
        .sidebar-mode {
            padding: 15px;
            margin: 0;
        }
        .sidebar-mode .input-group {
            flex-direction: column;
            margin-bottom: 10px;
        }
        .sidebar-mode .input-group label {
            min-width: auto;
            margin-bottom: 5px;
            font-size: 12px;
        }
        .sidebar-mode .product-grid {
            display: none;
        }
        
        /* Modal Styles - Full Screen Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999999;
            overflow-y: auto;
            /* Break out of iframe */
            transform: translateZ(0);
        }
        .modal-content {
            background: white;
            margin: 2vh auto;
            padding: 30px;
            border-radius: 15px;
            width: 95vw;
            max-width: 1200px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.3s ease-out;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-close {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
            background: #f5f5f5;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
        }
        .modal-close:hover {
            background: #e0e0e0;
            color: #333;
        }
        .launch-modal-btn {
            background: linear-gradient(135deg, #7cb342 0%, #8bc34a 100%);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(124,179,66,0.3);
            transition: all 0.3s ease;
        }
        .launch-modal-btn:hover {
            background: linear-gradient(135deg, #689f35 0%, #7cb342 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(124,179,66,0.4);
        }
        .header {
            text-align: center;
            color: #7cb342;
            margin-bottom: 30px;
        }
        .input-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .input-group label {
            font-weight: bold;
            min-width: 150px;
        }
        .input-group input, .input-group select {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .results {
            background: #f8f9fa;
            border-left: 4px solid #7cb342;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .results h3 {
            color: #7cb342;
            margin-top: 0;
        }
        .tier-info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .email-template {
            background: white;
            border: 2px solid #7cb342;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
        }
        .copy-btn {
            background: #7cb342;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        .copy-btn:hover {
            background: #689f35;
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .product-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
        }
        .pricing-tier {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .tier1 { background: #ffebee; color: #d32f2f; }
        .tier2 { background: #fff3e0; color: #f57c00; }
        .tier3 { background: #e8f5e8; color: #388e3c; }
        #emailOutput {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="sidebarView" class="calculator sidebar-mode">
        <div class="header" style="text-align: center; margin-bottom: 20px;">
            <h2 style="color: #7cb342; margin: 0;">🌿 Kanva Calculator</h2>
        </div>

        <!-- Launch Modal Button -->
        <button class="launch-modal-btn" onclick="openFullScreenModal()">
            📊 Open Full Calculator
        </button>

        <!-- Quick Calculation in Sidebar -->
        <div class="input-group">
            <label>Product:</label>
            <select id="sidebarProduct" onchange="updateSidebarResults()">
                <option value="focus">Focus + Flow</option>
                <option value="release">Release + Relax</option>
                <option value="zoom">Kanva Zoom</option>
                <option value="mango">Mango Extract</option>
            </select>
        </div>
        <div class="input-group">
            <label>Master Cases:</label>
            <input type="number" id="sidebarCases" value="28" min="1" max="500" onchange="updateSidebarResults()">
        </div>

        <!-- Quick Results -->
        <div class="results">
            <div id="sidebarResults" style="font-size: 14px;"></div>
        </div>
    </div>

    <!-- Modal Overlay - Full Screen -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close" onclick="closeFullScreenModal()">&times;</button>
            
            <div class="calculator">
                <div class="header">
                    <h1>🌿 Kanva Botanicals Quote Calculator</h1>
                    <p>Professional quote generation with accurate pricing</p>
                </div>

                <!-- Customer Information -->
                <h3>Customer Information</h3>
                <div class="input-group">
                    <label>Prospect Name:</label>
                    <input type="text" id="prospectName" placeholder="Eddie">
                </div>
                <div class="input-group">
                    <label>Company Name:</label>
                    <input type="text" id="companyName" placeholder="ABC Distribution">
                </div>
                <div class="input-group">
                    <label>Customer Base:</label>
                    <input type="text" id="customerBase" placeholder="smoke and vape shops">
                </div>

                <!-- Product Selection -->
                <h3>Product & Order Details</h3>
                <div class="input-group">
                    <label>Primary Product:</label>
                    <select id="primaryProduct">
                        <option value="focus">Focus + Flow ($4.50)</option>
                        <option value="release">Release + Relax ($4.50)</option>
                        <option value="zoom">Kanva Zoom ($3.10)</option>
                        <option value="mango">Mango Extract ($4.25)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Master Cases:</label>
                    <input type="number" id="masterCases" value="28" min="1" max="500">
                </div>
                <div class="input-group">
                    <label>Max Retail Price:</label>
                    <input type="number" id="maxRetail" value="5.00" step="0.01" min="0">
                </div>

                <!-- Calculation Results -->
                <div class="results">
                    <h3>Order Calculation</h3>
                    <div id="orderResults"></div>
                    <div id="tierInfo" class="tier-info"></div>
                </div>

                <!-- Action Buttons -->
                <div style="display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap;">
                    <button class="copy-btn" onclick="generateEmail()">📧 Generate Quote Email</button>
                    <button class="copy-btn" onclick="saveQuoteToCRM()" style="background: #2196F3;">💾 Save to CRM</button>
                    <button class="copy-btn" onclick="createOpportunity()" style="background: #FF9800;">🎯 Create Opportunity</button>
                    <button class="copy-btn" onclick="closeFullScreenModal()" style="background: #666;">✖️ Close Calculator</button>
                </div>

                <!-- Generated Email Template -->
                <div class="email-template" id="emailTemplate" style="display: none; margin-top: 20px;">
                    <h3>Generated Quote Email</h3>
                    <button class="copy-btn" onclick="copyEmail()">📋 Copy Email to Clipboard</button>
                    <div id="emailOutput"></div>
                </div>

                <!-- Product Reference -->
                <h3>Quick Product Reference</h3>
                <div class="product-grid">
                    <div class="product-card">
                        <h4>2oz Wellness Shots</h4>
                        <p><strong>Focus + Flow:</strong> $4.50 → $9.99 MSRP <span class="pricing-tier tier1">10% margin</span></p>
                        <p><strong>Release + Relax:</strong> $4.50 → $9.99 MSRP <span class="pricing-tier tier1">10% margin</span></p>
                        <p><strong>Raw + Releaf:</strong> <em>Coming Soon</em></p>
                    </div>
                    <div class="product-card">
                        <h4>Energy & Extract Shots</h4>
                        <p><strong>Kanva Zoom:</strong> $3.10 → $6.99 MSRP <span class="pricing-tier tier1">11.43% margin</span></p>
                        <p><strong>Mango Extract:</strong> $4.25 → $9.99 MSRP <span class="pricing-tier tier2">15% margin</span></p>
                    </div>
                    <div class="product-card">
                        <h4>High-Margin Products</h4>
                        <p><strong>Kratom Capsules:</strong> 49-58% margins <span class="pricing-tier tier3">High Profit</span></p>
                        <p><strong>Kratom Powders:</strong> 49-56% margins <span class="pricing-tier tier3">High Profit</span></p>
                        <p><em>Perfect add-ons for experienced customers</em></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const products = {
            focus: { name: "Focus + Flow", price: 4.50, msrp: 9.99, unitsPerCase: 144 },
            release: { name: "Release + Relax", price: 4.50, msrp: 9.99, unitsPerCase: 96 },
            zoom: { name: "Kanva Zoom", price: 3.10, msrp: 6.99, unitsPerCase: 144 },
            mango: { name: "Mango Extract", price: 4.25, msrp: 9.99, unitsPerCase: 144 }
        };

        function getTier(masterCases) {
            if (masterCases < 56) return { tier: 1, discount: 0, name: "Tier 1" };
            if (masterCases < 112) return { tier: 2, discount: 0.035, name: "Tier 2" };
            return { tier: 3, discount: 0.06, name: "Tier 3" };
        }

        function calculateOrder() {
            const productKey = document.getElementById('primaryProduct').value;
            const masterCases = parseInt(document.getElementById('masterCases').value) || 0;
            const product = products[productKey];
            const tierInfo = getTier(masterCases);
            
            const unitPrice = product.price * (1 - tierInfo.discount);
            const casePrice = unitPrice * product.unitsPerCase;
            const totalUnits = masterCases * product.unitsPerCase;
            const displayBoxes = product.unitsPerCase === 144 ? masterCases * 12 : masterCases * 8;
            const subtotal = masterCases * casePrice;
            const shipping = subtotal * 0.015; // 1.5% shipping
            const total = subtotal + shipping;

            return {
                product,
                tierInfo,
                masterCases,
                unitPrice: unitPrice.toFixed(2),
                casePrice: casePrice.toFixed(2),
                totalUnits,
                displayBoxes,
                subtotal: subtotal.toFixed(2),
                shipping: shipping.toFixed(2),
                total: total.toFixed(2)
            };
        }

        function updateResults() {
            const calc = calculateOrder();
            const nextTier = calc.tierInfo.tier < 3 ? calc.tierInfo.tier + 1 : null;
            const nextTierThreshold = calc.tierInfo.tier === 1 ? 56 : 112;

            document.getElementById('orderResults').innerHTML = `
                <p><strong>${calc.product.name} - ${calc.masterCases} Master Cases</strong></p>
                <p>📦 <strong>${calc.displayBoxes}</strong> Display Boxes | <strong>${calc.totalUnits.toLocaleString()}</strong> Individual Units</p>
                <p>💰 Unit Price: <strong>$${calc.unitPrice}</strong> | Case Price: <strong>$${calc.casePrice}</strong></p>
                <p>📊 Subtotal: <strong>$${parseFloat(calc.subtotal).toLocaleString()}</strong></p>
                <p>🚚 Shipping: <strong>$${parseFloat(calc.shipping).toLocaleString()}</strong></p>
                <p style="font-size: 18px; color: #7cb342;"><strong>💳 TOTAL: $${parseFloat(calc.total).toLocaleString()}</strong></p>
            `;

            const tierClass = `tier${calc.tierInfo.tier}`;
            const savingsText = calc.tierInfo.discount > 0 ? ` (${(calc.tierInfo.discount * 100).toFixed(1)}% savings)` : '';
            const nextTierText = nextTier ? `<br><small>📈 Order ${nextTierThreshold}+ cases to qualify for Tier ${nextTier} pricing</small>` : '';

            document.getElementById('tierInfo').innerHTML = `
                <strong class="pricing-tier ${tierClass}">${calc.tierInfo.name}</strong> pricing applied${savingsText}${nextTierText}
            `;
        }

        function generateEmail() {
            const calc = calculateOrder();
            const prospectName = document.getElementById('prospectName').value || "[PROSPECT NAME]";
            const companyName = document.getElementById('companyName').value || "[COMPANY NAME]";
            const customerBase = document.getElementById('customerBase').value || "[CUSTOMER BASE]";
            const maxRetail = document.getElementById('maxRetail').value || "5.00";

            const email = `Subject: Partnership Proposal - ${calc.masterCases} Master Cases | ${companyName}

Hi ${prospectName},

Thank you for your interest in partnering with Kanva Botanicals! We're excited about the opportunity to work with you.

## Partnership Overview

We'd like to move forward with an initial ${calc.masterCases} Master Case order of ${calc.product.name}. Given your strong customer base in ${customerBase}, we believe this will be an excellent fit for both our businesses.

### Pricing Guidelines
To maintain market stability and ensure fair margins for all partners in your area, we ask that your retail price to customers not exceed **$${maxRetail}** per unit.

## Order Breakdown

**${calc.masterCases} Master Cases Contains:**
- ${calc.masterCases} Master Cases
- ${calc.displayBoxes} Display Boxes  
- ${calc.totalUnits.toLocaleString()} Individual Units

### ${calc.tierInfo.name} Wholesale Pricing:
- **Per Unit:** $${calc.unitPrice}
- **Per Master Case:** $${calc.casePrice}
- **Subtotal:** $${parseFloat(calc.subtotal).toLocaleString()}
- **Shipping & Handling:** $${parseFloat(calc.shipping).toLocaleString()}
- **TOTAL:** $${parseFloat(calc.total).toLocaleString()}

${calc.tierInfo.tier < 3 ? `*Note: Future orders of ${calc.tierInfo.tier === 1 ? '56' : '112'}+ Master Cases will qualify for improved pricing.*` : ''}

## Payment Information

${parseFloat(calc.total) >= 10000 ? 
`Since this order exceeds $10,000, payment will need to be processed via **ACH transfer**. I'll send over a DocuSign agreement that includes the ACH transfer details. Please provide a voided blank check for account verification.` : 
`Payment options: ACH transfer, wire transfer, or company check.`}

## Additional Product Opportunities

Our complete product line includes high-margin kratom capsules and powders (49-58% margins) that could be excellent additions for your experienced customers. Full catalog available upon request.

## Support Included
✅ **Retail Support** - In-store displays, POS materials, promotional strategies  
✅ **Sales Training** - Staff education and product knowledge support  
✅ **Marketing Assets** - Digital materials, window clings, branded displays  
✅ **Exclusive Offers** - Introductory pricing and promotional bundles  

## Next Steps

1. Review this proposal
2. Complete payment setup (DocuSign/ACH if applicable)
3. Schedule delivery once payment is processed

We're excited about building a successful partnership with you and supporting your business growth in the functional beverage market.

Please let me know if you have any questions or need any clarification on these terms.

Best regards,

[YOUR NAME]  
[YOUR TITLE]  
Kanva Botanicals  
[PHONE NUMBER]  
[EMAIL ADDRESS]`;

            document.getElementById('emailOutput').textContent = email;
            document.getElementById('emailTemplate').style.display = 'block';
            document.getElementById('emailTemplate').scrollIntoView({ behavior: 'smooth' });
        }

        function copyEmail() {
            const emailText = document.getElementById('emailOutput').textContent;
            navigator.clipboard.writeText(emailText).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '✅ Copied!';
                btn.style.background = '#4caf50';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#7cb342';
                }, 2000);
            });
        }

        // Modal Functions
        function openModal() {
            document.getElementById('modalOverlay').style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
            
            // Sync values from sidebar to modal
            document.getElementById('primaryProduct').value = document.getElementById('sidebarProduct').value;
            document.getElementById('masterCases').value = document.getElementById('sidebarCases').value;
            
            updateResults();
        }

        function closeModal(event) {
            if (event && event.target !== document.getElementById('modalOverlay')) return;
            document.getElementById('modalOverlay').style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
        }

        // Sidebar Functions
        function updateSidebarResults() {
            const productKey = document.getElementById('sidebarProduct').value;
            const masterCases = parseInt(document.getElementById('sidebarCases').value) || 0;
            const product = products[productKey];
            const tierInfo = getTier(masterCases);
            
            const unitPrice = product.price * (1 - tierInfo.discount);
            const total = (masterCases * unitPrice * product.unitsPerCase * 1.015).toFixed(0);
            
            document.getElementById('sidebarResults').innerHTML = `
                <p><strong>${product.name}</strong></p>
                <p>💰 <strong>${unitPrice.toFixed(2)}</strong> per unit</p>
                <p>📦 <strong>${masterCases}</strong> Master Cases</p>
                <p style="color: #7cb342; font-weight: bold;">Total: ${parseInt(total).toLocaleString()}</p>
                <p style="font-size: 12px; color: #666;">${tierInfo.name} pricing</p>
            `;
        }

        // CRM Integration Functions (Placeholder for now)
        function saveQuoteToCRM() {
            const calc = calculateOrder();
            alert(`Quote saved to CRM!\n\nProduct: ${calc.product.name}\nCases: ${calc.masterCases}\nTotal: ${parseFloat(calc.total).toLocaleString()}\n\n(This will integrate with Copper API in the next phase)`);
        }

        function createOpportunity() {
            const calc = calculateOrder();
            alert(`Opportunity created!\n\nValue: ${parseFloat(calc.total).toLocaleString()}\nProduct: ${calc.product.name}\nStatus: Quote Sent\n\n(This will integrate with Copper API in the next phase)`);
        }

        // Auto-update results when inputs change
        document.getElementById('masterCases').addEventListener('input', updateResults);
        document.getElementById('primaryProduct').addEventListener('change', updateResults);

        // Initialize both sidebar and modal
        updateSidebarResults();
        updateResults();

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal({ target: document.getElementById('modalOverlay') });
            }
        });
    </script>
</body>
</html>
