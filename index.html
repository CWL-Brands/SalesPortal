.tier1 { background: #ffebee; color: #d32f2f; }
        .tier2 { background: #fff3e0; color: #f57c00; }
        .tier3 { background: #e8f5e8; color: #388e3c; }
        
        /* Admin Panel Styles */
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            overflow-y: auto;
        }
        .admin-content {
            background: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            position: relative;
        }
        .admin-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }
        .admin-close:hover {
            color: #333;
        }
        .admin-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .admin-section h3 {
            margin-top: 0;
            color: #7cb342;
            border-bottom: 2px solid #7cb342;
            padding-bottom: 10px;
        }
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .admin-field {
            display: flex;
            flex-direction: column;
        }
        .admin-field label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 12px;
            color: #555;
        }
        .admin-field input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .admin-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 30px;
        }
        .admin-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        .admin-btn-save {
            background: #4CAF50;
            color: white;
        }
        .admin-btn-cancel {
            background: #f44336;
            color: white;
        }
        .admin-btn-reset {
            background: #FF9800;
            color: white;
        }
        .admin-btn:hover {
            opacity: 0.9;
        }
        .admin-toggle {
            background: #9C27B0;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        .admin-toggle:hover {
            background: #7B1FA2;
        }
        <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanva Botanicals Quote Calculator</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/copper-sdk@latest/dist/copper-sdk.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #f5f5f5;
        }
        
        /* Modal Mode - Larger sizing */
        .modal-mode {
            max-width: 1180px;
            margin: 0 auto;
            padding: 20px;
            min-height: 760px;
        }
        
        /* Left Navigation Mode - Full calculator without modal */
        .left-nav-mode {
            padding: 20px;
            background-color: white;
            min-height: 100vh;
        }
        
        .left-nav-mode .calculator {
            background: white;
            box-shadow: none;
            border: none;
            padding: 0;
        }
        
        .left-nav-mode .input-group {
            margin-bottom: 18px;
        }
        
        .left-nav-mode .input-group label {
            min-width: 130px;
            font-size: 14px;
        }
        
        .left-nav-mode .input-group input,
        .left-nav-mode .input-group select {
            padding: 10px;
            font-size: 14px;
        }
        
        .left-nav-mode .header h1 {
            font-size: 24px;
        }
        
        .left-nav-mode .results {
            padding: 20px;
            margin: 20px 0;
        }
        
        .modal-mode .calculator {
            min-height: 700px;
        }
        
        .modal-mode .input-group {
            margin-bottom: 20px;
        }
        
        .modal-mode .input-group label {
            min-width: 140px;
            font-size: 15px;
        }
        
        .modal-mode .input-group input,
        .modal-mode .input-group select {
            padding: 12px;
            font-size: 15px;
        }
        
        .modal-mode .results {
            padding: 25px;
            margin: 25px 0;
        }
        
        .modal-mode .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .modal-mode .header p {
            font-size: 16px;
            margin-bottom: 30px;
        }
        
        .calculator {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        /* Sidebar Mode - Compact */
        .sidebar-mode {
            padding: 10px;
            margin: 0;
        }
        .sidebar-mode .input-group {
            flex-direction: column;
            margin-bottom: 8px;
        }
        .sidebar-mode .input-group label {
            min-width: auto;
            margin-bottom: 3px;
            font-size: 11px;
            font-weight: bold;
        }
        .sidebar-mode .input-group input,
        .sidebar-mode .input-group select {
            padding: 6px;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 100%;
            box-sizing: border-box;
        }
        .sidebar-mode .results {
            padding: 10px;
            font-size: 12px;
            margin: 10px 0;
        }
        .sidebar-mode .product-grid {
            display: none;
        }
        
        .header {
            text-align: center;
            color: #7cb342;
            margin-bottom: 20px;
        }
        .input-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .input-group label {
            font-weight: bold;
            min-width: 120px;
        }
        .input-group input, .input-group select {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            flex: 1;
        }
        .results {
            background: #f8f9fa;
            border-left: 4px solid #7cb342;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .results h3 {
            color: #7cb342;
            margin-top: 0;
        }
        .tier-info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .copy-btn {
            background: #7cb342;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .copy-btn:hover {
            background: #689f35;
        }
        .launch-modal-btn {
            background: linear-gradient(135deg, #7cb342 0%, #8bc34a 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(124,179,66,0.3);
        }
        .launch-modal-btn:hover {
            background: linear-gradient(135deg, #689f35 0%, #7cb342 100%);
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .product-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
        }
        .pricing-tier {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 8px;
        }
        .tier1 { background: #ffebee; color: #d32f2f; }
        .tier2 { background: #fff3e0; color: #f57c00; }
        .tier3 { background: #e8f5e8; color: #388e3c; }
        #emailOutput {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Initialize Copper SDK
        let sdk;
        let isModalMode = false;
        let isLeftNav = false;
        let isAdmin = false;
        let appLocation = 'sidebar'; // default
        let currentUser = null;
        
        // Admin email list (you can modify this)
        const adminEmails = [
            'shane@kanvabotanicals.com',
            'ben@kanvabotanicals.com',
            'rob@cwlbrands.com'
            'corey@cwlbrands.com'
            // Add more admin emails as needed
        ];
        
        // Check URL parameters and context
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('location') === 'modal') {
            isModalMode = true;
            appLocation = 'modal';
            document.body.className = 'modal-mode';
        }

        // Initialize SDK and get context
        try {
            sdk = window.Copper.init();
            
            // Get context to determine location and user
            sdk.getContext().then(function(data) {
                console.log('Copper context:', data);
                currentUser = data.user || null;
                
                // Check admin privileges
                if (currentUser && currentUser.email) {
                    isAdmin = adminEmails.includes(currentUser.email.toLowerCase());
                    console.log('Admin status:', isAdmin);
                }
                
                // Check if we're in left navigation
                if (data && (data.location === 'left_nav' || window.innerWidth > 800)) {
                    isLeftNav = true;
                    appLocation = 'left_nav';
                    document.body.className = 'left-nav-mode';
                }
                
                renderApp(); // Re-render with proper permissions and layout
            }).catch(function(error) {
                console.log('Could not get Copper context:', error);
            });
            
            // Configure modal size (only affects modal mode)
            if (isModalMode) {
                sdk.setAppUI({
                    width: 1200,
                    height: 800,
                    showActionBar: false,
                    disableAddButton: true
                });
            }
            
            console.log('Copper SDK initialized');
        } catch (e) {
            console.log('Running outside Copper environment');
            // If running standalone, assume left nav mode and admin for testing
            isLeftNav = true;
            isAdmin = true; // For testing purposes
            appLocation = 'left_nav';
            document.body.className = 'left-nav-mode';
        }

        // Admin configurable variables (stored in memory for now)
        let adminConfig = {
            products: {
                focus: { name: "Focus + Flow", price: 4.50, msrp: 9.99, unitsPerCase: 144 },
                release: { name: "Release + Relax", price: 4.50, msrp: 9.99, unitsPerCase: 96 },
                zoom: { name: "Kanva Zoom", price: 3.10, msrp: 6.99, unitsPerCase: 144 },
                mango: { name: "Mango Extract", price: 4.25, msrp: 9.99, unitsPerCase: 144 }
            },
            tiers: {
                tier1: { threshold: 0, discount: 0, name: "Tier 1" },
                tier2: { threshold: 56, discount: 0.035, name: "Tier 2" },
                tier3: { threshold: 112, discount: 0.06, name: "Tier 3" }
            },
            shipping: {
                rate: 0.015,  // 1.5%
                freeThreshold: 50000  // Free shipping over $50k
            },
            payment: {
                achThreshold: 10000  // ACH required over $10k
            },
            maxRetailPrices: {
                default: 5.00,
                focus: 5.00,
                release: 5.00,
                zoom: 5.00,
                mango: 5.00
            }
        };

        // Use admin config instead of hardcoded values
        const products = adminConfig.products;

        function getTier(masterCases) {
            const tiers = adminConfig.tiers;
            if (masterCases < tiers.tier2.threshold) return tiers.tier1;
            if (masterCases < tiers.tier3.threshold) return tiers.tier2;
            return tiers.tier3;
        }

        function calculateOrder() {
            const productKey = document.getElementById('primaryProduct').value;
            const masterCases = parseInt(document.getElementById('masterCases').value) || 0;
            const product = adminConfig.products[productKey];
            const tierInfo = getTier(masterCases);
            
            const unitPrice = product.price * (1 - tierInfo.discount);
            const casePrice = unitPrice * product.unitsPerCase;
            const totalUnits = masterCases * product.unitsPerCase;
            const displayBoxes = product.unitsPerCase === 144 ? masterCases * 12 : masterCases * 8;
            const subtotal = masterCases * casePrice;
            
            // Use admin configurable shipping
            let shipping = subtotal * adminConfig.shipping.rate;
            if (subtotal >= adminConfig.shipping.freeThreshold) {
                shipping = 0; // Free shipping over threshold
            }
            
            const total = subtotal + shipping;

            return {
                product,
                tierInfo,
                masterCases,
                unitPrice: unitPrice.toFixed(2),
                casePrice: casePrice.toFixed(2),
                totalUnits,
                displayBoxes,
                subtotal: subtotal.toFixed(2),
                shipping: shipping.toFixed(2),
                total: total.toFixed(2),
                freeShipping: shipping === 0 && subtotal >= adminConfig.shipping.freeThreshold
            };
        }

        function updateResults() {
            if (!document.getElementById('orderResults')) return;
            
            const calc = calculateOrder();
            const nextTierThreshold = calc.tierInfo.name === "Tier 1" ? adminConfig.tiers.tier2.threshold : adminConfig.tiers.tier3.threshold;
            const hasNextTier = calc.tierInfo.name !== "Tier 3";

            document.getElementById('orderResults').innerHTML = `
                <p><strong>${calc.product.name} - ${calc.masterCases} Master Cases</strong></p>
                <p>📦 <strong>${calc.displayBoxes}</strong> Display Boxes | <strong>${calc.totalUnits.toLocaleString()}</strong> Individual Units</p>
                <p>💰 Unit Price: <strong>${calc.unitPrice}</strong> | Case Price: <strong>${calc.casePrice}</strong></p>
                <p>📊 Subtotal: <strong>${parseFloat(calc.subtotal).toLocaleString()}</strong></p>
                <p>🚚 Shipping: <strong>${calc.freeShipping ? 'FREE' : '

        function updateSidebarResults() {
            if (!document.getElementById('sidebarResults')) return;
            
            const productKey = document.getElementById('sidebarProduct').value;
            const masterCases = parseInt(document.getElementById('sidebarCases').value) || 0;
            const product = adminConfig.products[productKey];
            const tierInfo = getTier(masterCases);
            
            const unitPrice = product.price * (1 - tierInfo.discount);
            const subtotal = masterCases * unitPrice * product.unitsPerCase;
            let shipping = subtotal * adminConfig.shipping.rate;
            if (subtotal >= adminConfig.shipping.freeShreshold) shipping = 0;
            const total = subtotal + shipping;
            
            document.getElementById('sidebarResults').innerHTML = `
                <p><strong>${product.name}</strong></p>
                <p>💰 <strong>${unitPrice.toFixed(2)}</strong> per unit</p>
                <p>📦 <strong>${masterCases}</strong> Master Cases</p>
                <p style="color: #7cb342; font-weight: bold;">Total: ${parseInt(total).toLocaleString()}</p>
                <p style="font-size: 11px; color: #666;">${tierInfo.name} pricing</p>
            `;
        }

        // Admin functions
        function showAdminPanel() {
            document.getElementById('adminPanel').style.display = 'block';
            populateAdminForm();
        }

        function hideAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }

        function populateAdminForm() {
            // Populate product settings
            Object.keys(adminConfig.products).forEach(key => {
                const product = adminConfig.products[key];
                document.getElementById(`admin_${key}_price`).value = product.price;
                document.getElementById(`admin_${key}_msrp`).value = product.msrp;
                document.getElementById(`admin_${key}_units`).value = product.unitsPerCase;
            });

            // Populate tier settings
            document.getElementById('admin_tier2_threshold').value = adminConfig.tiers.tier2.threshold;
            document.getElementById('admin_tier2_discount').value = (adminConfig.tiers.tier2.discount * 100).toFixed(1);
            document.getElementById('admin_tier3_threshold').value = adminConfig.tiers.tier3.threshold;
            document.getElementById('admin_tier3_discount').value = (adminConfig.tiers.tier3.discount * 100).toFixed(1);

            // Populate shipping settings
            document.getElementById('admin_shipping_rate').value = (adminConfig.shipping.rate * 100).toFixed(2);
            document.getElementById('admin_free_shipping').value = adminConfig.shipping.freeThreshold;
            document.getElementById('admin_ach_threshold').value = adminConfig.payment.achThreshold;
        }

        function saveAdminSettings() {
            try {
                // Update product settings
                Object.keys(adminConfig.products).forEach(key => {
                    adminConfig.products[key].price = parseFloat(document.getElementById(`admin_${key}_price`).value);
                    adminConfig.products[key].msrp = parseFloat(document.getElementById(`admin_${key}_msrp`).value);
                    adminConfig.products[key].unitsPerCase = parseInt(document.getElementById(`admin_${key}_units`).value);
                });

                // Update tier settings
                adminConfig.tiers.tier2.threshold = parseInt(document.getElementById('admin_tier2_threshold').value);
                adminConfig.tiers.tier2.discount = parseFloat(document.getElementById('admin_tier2_discount').value) / 100;
                adminConfig.tiers.tier3.threshold = parseInt(document.getElementById('admin_tier3_threshold').value);
                adminConfig.tiers.tier3.discount = parseFloat(document.getElementById('admin_tier3_discount').value) / 100;

                // Update shipping settings
                adminConfig.shipping.rate = parseFloat(document.getElementById('admin_shipping_rate').value) / 100;
                adminConfig.shipping.freeThreshold = parseFloat(document.getElementById('admin_free_shipping').value);
                adminConfig.payment.achThreshold = parseFloat(document.getElementById('admin_ach_threshold').value);

                // Save to localStorage for persistence
                localStorage.setItem('kanvaAdminConfig', JSON.stringify(adminConfig));

                alert('Settings saved successfully!');
                hideAdminPanel();
                
                // Refresh calculations
                updateResults();
                updateSidebarResults();
                
            } catch (error) {
                alert('Error saving settings: ' + error.message);
            }
        }

        function resetAdminSettings() {
            if (confirm('Are you sure you want to reset all settings to defaults? This cannot be undone.')) {
                localStorage.removeItem('kanvaAdminConfig');
                location.reload(); // Reload to get default settings
            }
        }

        // Load admin settings from localStorage on startup
        function loadAdminSettings() {
            try {
                const saved = localStorage.getItem('kanvaAdminConfig');
                if (saved) {
                    const savedConfig = JSON.parse(saved);
                    // Merge saved config with defaults to handle new fields
                    adminConfig = { ...adminConfig, ...savedConfig };
                    console.log('Loaded admin settings from localStorage');
                }
            } catch (error) {
                console.log('Error loading admin settings:', error);
            }
        }

        function openCopperModal() {
            if (sdk && sdk.showModal) {
                sdk.showModal();
            } else {
                alert('Copper SDK not available. This feature requires running within Copper CRM.');
            }
        }

        function generateEmail() {
            const calc = calculateOrder();
            const prospectName = document.getElementById('prospectName').value || "[PROSPECT NAME]";
            const companyName = document.getElementById('companyName').value || "[COMPANY NAME]";
            const customerBase = document.getElementById('customerBase').value || "[CUSTOMER BASE]";
            const maxRetail = document.getElementById('maxRetail').value || adminConfig.maxRetailPrices.default;

            const email = `Subject: Partnership Proposal - ${calc.masterCases} Master Cases | ${companyName}

Hi ${prospectName},

Thank you for your interest in partnering with Kanva Botanicals! We're excited about the opportunity to work with you.

## Partnership Overview

We'd like to move forward with an initial ${calc.masterCases} Master Case order of ${calc.product.name}. Given your strong customer base in ${customerBase}, we believe this will be an excellent fit for both our businesses.

### Pricing Guidelines
To maintain market stability and ensure fair margins for all partners in your area, we ask that your retail price to customers not exceed **${maxRetail}** per unit.

## Order Breakdown

**${calc.masterCases} Master Cases Contains:**
- ${calc.masterCases} Master Cases
- ${calc.displayBoxes} Display Boxes  
- ${calc.totalUnits.toLocaleString()} Individual Units

### ${calc.tierInfo.name} Wholesale Pricing:
- **Per Unit:** ${calc.unitPrice}
- **Per Master Case:** ${calc.casePrice}
- **Subtotal:** ${parseFloat(calc.subtotal).toLocaleString()}
- **Shipping & Handling:** ${calc.freeShipping ? 'FREE' : '

        function copyEmail() {
            const emailText = document.getElementById('emailOutput').textContent;
            navigator.clipboard.writeText(emailText).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '✅ Copied!';
                btn.style.background = '#4caf50';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#7cb342';
                }, 2000);
            });
        }

        function saveQuoteToCRM() {
            const calc = calculateOrder();
            if (sdk && sdk.logActivity) {
                const details = `Quote Generated: ${calc.product.name} - ${calc.masterCases} Master Cases - $${parseFloat(calc.total).toLocaleString()}`;
                sdk.logActivity(0, details); // Activity Type 'note'
                alert('Quote saved to CRM activity log!');
            } else {
                alert(`Quote would be saved to CRM!\n\nProduct: ${calc.product.name}\nCases: ${calc.masterCases}\nTotal: $${parseFloat(calc.total).toLocaleString()}`);
            }
        }

        function createOpportunity() {
            const calc = calculateOrder();
            if (sdk && sdk.createEntity) {
                const opportunityData = {
                    name: `${calc.product.name} - ${calc.masterCases} MC`,
                    monetary_value: parseFloat(calc.total) * 100, // Convert to cents
                    details: `Quote: ${calc.masterCases} Master Cases of ${calc.product.name}`
                };
                sdk.createEntity('opportunity', opportunityData);
                alert('Opportunity created in Copper!');
            } else {
                alert(`Opportunity would be created!\n\nValue: $${parseFloat(calc.total).toLocaleString()}\nProduct: ${calc.product.name}\nStatus: Quote Sent`);
            }
        }

        function renderApp() {
            const appDiv = document.getElementById('app');
            
            if (isModalMode || isLeftNav) {
                // Full calculator interface (for both modal and left nav)
                appDiv.innerHTML = `
                    <div class="calculator">
                        <div class="header">
                            <h1>🌿 Kanva Botanicals Quote Calculator</h1>
                            <p>Professional quote generation with accurate pricing</p>
                            ${isLeftNav ? '<p style="color: #666; font-size: 14px;">Left Navigation Mode - Full Calculator</p>' : ''}
                            ${isAdmin ? '<button class="admin-toggle" onclick="showAdminPanel()">⚙️ Admin Settings</button>' : ''}
                        </div>

                        <!-- Customer Information -->
                        <h3>Customer Information</h3>
                        <div class="input-group">
                            <label>Prospect Name:</label>
                            <input type="text" id="prospectName" placeholder="Eddie">
                        </div>
                        <div class="input-group">
                            <label>Company Name:</label>
                            <input type="text" id="companyName" placeholder="ABC Distribution">
                        </div>
                        <div class="input-group">
                            <label>Customer Base:</label>
                            <input type="text" id="customerBase" placeholder="smoke and vape shops">
                        </div>

                        <!-- Product Selection -->
                        <h3>Product & Order Details</h3>
                        <div class="input-group">
                            <label>Primary Product:</label>
                            <select id="primaryProduct">
                                <option value="focus">${adminConfig.products.focus.name} (${adminConfig.products.focus.price})</option>
                                <option value="release">${adminConfig.products.release.name} (${adminConfig.products.release.price})</option>
                                <option value="zoom">${adminConfig.products.zoom.name} (${adminConfig.products.zoom.price})</option>
                                <option value="mango">${adminConfig.products.mango.name} (${adminConfig.products.mango.price})</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Master Cases:</label>
                            <input type="number" id="masterCases" value="28" min="1" max="500">
                        </div>
                        <div class="input-group">
                            <label>Max Retail Price:</label>
                            <input type="number" id="maxRetail" value="${adminConfig.maxRetailPrices.default}" step="0.01" min="0">
                        </div>

                        <!-- Calculation Results -->
                        <div class="results">
                            <h3>Order Calculation</h3>
                            <div id="orderResults"></div>
                            <div id="tierInfo" class="tier-info"></div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap;">
                            <button class="copy-btn" onclick="generateEmail()">📧 Generate Quote Email</button>
                            <button class="copy-btn" onclick="saveQuoteToCRM()" style="background: #2196F3;">💾 Save to CRM</button>
                            <button class="copy-btn" onclick="createOpportunity()" style="background: #FF9800;">🎯 Create Opportunity</button>
                            ${isLeftNav ? '<button class="copy-btn" onclick="openCopperModal()" style="background: #9C27B0;">🔍 Open in Modal</button>' : ''}
                        </div>

                        <!-- Generated Email Template -->
                        <div id="emailTemplate" style="display: none; margin-top: 20px; background: white; border: 2px solid #7cb342; border-radius: 10px; padding: 25px;">
                            <h3>Generated Quote Email</h3>
                            <button class="copy-btn" onclick="copyEmail()">📋 Copy Email to Clipboard</button>
                            <div id="emailOutput"></div>
                        </div>

                        <!-- Product Reference -->
                        <h3>Quick Product Reference</h3>
                        <div class="product-grid">
                            <div class="product-card">
                                <h4>2oz Wellness Shots</h4>
                                <p><strong>${adminConfig.products.focus.name}:</strong> ${adminConfig.products.focus.price} → ${adminConfig.products.focus.msrp} MSRP</p>
                                <p><strong>${adminConfig.products.release.name}:</strong> ${adminConfig.products.release.price} → ${adminConfig.products.release.msrp} MSRP</p>
                                <p><strong>Raw + Releaf:</strong> <em>Coming Soon</em></p>
                            </div>
                            <div class="product-card">
                                <h4>Energy & Extract Shots</h4>
                                <p><strong>${adminConfig.products.zoom.name}:</strong> ${adminConfig.products.zoom.price} → ${adminConfig.products.zoom.msrp} MSRP</p>
                                <p><strong>${adminConfig.products.mango.name}:</strong> ${adminConfig.products.mango.price} → ${adminConfig.products.mango.msrp} MSRP</p>
                            </div>
                            <div class="product-card">
                                <h4>Tier Information</h4>
                                <p><strong>Tier 1:</strong> 0-${adminConfig.tiers.tier2.threshold-1} cases (${adminConfig.tiers.tier1.discount*100}% discount)</p>
                                <p><strong>Tier 2:</strong> ${adminConfig.tiers.tier2.threshold}-${adminConfig.tiers.tier3.threshold-1} cases (${(adminConfig.tiers.tier2.discount*100).toFixed(1)}% discount)</p>
                                <p><strong>Tier 3:</strong> ${adminConfig.tiers.tier3.threshold}+ cases (${(adminConfig.tiers.tier3.discount*100).toFixed(1)}% discount)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Panel -->
                    <div id="adminPanel" class="admin-panel">
                        <div class="admin-content">
                            <span class="admin-close" onclick="hideAdminPanel()">&times;</span>
                            <h2 style="color: #7cb342; text-align: center;">⚙️ Admin Settings</h2>
                            <p style="text-align: center; color: #666;">Configure pricing, tiers, and business rules</p>

                            <!-- Product Settings -->
                            <div class="admin-section">
                                <h3>Product Pricing</h3>
                                ${Object.keys(adminConfig.products).map(key => {
                                    const product = adminConfig.products[key];
                                    return `
                                        <div class="admin-grid">
                                            <div class="admin-field">
                                                <label>${product.name} - Wholesale Price</label>
                                                <input type="number" id="admin_${key}_price" step="0.01" min="0">
                                            </div>
                                            <div class="admin-field">
                                                <label>${product.name} - MSRP</label>
                                                <input type="number" id="admin_${key}_msrp" step="0.01" min="0">
                                            </div>
                                            <div class="admin-field">
                                                <label>${product.name} - Units per Case</label>
                                                <input type="number" id="admin_${key}_units" min="1">
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>

                            <!-- Tier Settings -->
                            <div class="admin-section">
                                <h3>Volume Tier Settings</h3>
                                <div class="admin-grid">
                                    <div class="admin-field">
                                        <label>Tier 2 Threshold (Master Cases)</label>
                                        <input type="number" id="admin_tier2_threshold" min="1">
                                    </div>
                                    <div class="admin-field">
                                        <label>Tier 2 Discount (%)</label>
                                        <input type="number" id="admin_tier2_discount" step="0.1" min="0" max="50">
                                    </div>
                                    <div class="admin-field">
                                        <label>Tier 3 Threshold (Master Cases)</label>
                                        <input type="number" id="admin_tier3_threshold" min="1">
                                    </div>
                                    <div class="admin-field">
                                        <label>Tier 3 Discount (%)</label>
                                        <input type="number" id="admin_tier3_discount" step="0.1" min="0" max="50">
                                    </div>
                                </div>
                            </div>

                            <!-- Shipping & Payment Settings -->
                            <div class="admin-section">
                                <h3>Shipping & Payment Settings</h3>
                                <div class="admin-grid">
                                    <div class="admin-field">
                                        <label>Shipping Rate (%)</label>
                                        <input type="number" id="admin_shipping_rate" step="0.01" min="0" max="10">
                                    </div>
                                    <div class="admin-field">
                                        <label>Free Shipping Threshold ($)</label>
                                        <input type="number" id="admin_free_shipping" min="0">
                                    </div>
                                    <div class="admin-field">
                                        <label>ACH Required Threshold ($)</label>
                                        <input type="number" id="admin_ach_threshold" min="0">
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="admin-buttons">
                                <button class="admin-btn admin-btn-save" onclick="saveAdminSettings()">💾 Save Settings</button>
                                <button class="admin-btn admin-btn-cancel" onclick="hideAdminPanel()">❌ Cancel</button>
                                <button class="admin-btn admin-btn-reset" onclick="resetAdminSettings()">🔄 Reset to Defaults</button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add event listeners for full calculator
                document.getElementById('masterCases').addEventListener('input', updateResults);
                document.getElementById('primaryProduct').addEventListener('change', updateResults);
                updateResults();
            } else {
                // Compact sidebar interface (only for sidebar placement)
                appDiv.innerHTML = `
                    <div class="calculator sidebar-mode">
                        <div class="header" style="text-align: center; margin-bottom: 15px;">
                            <h3 style="color: #7cb342; margin: 0; font-size: 16px;">🌿 Kanva Calculator</h3>
                            ${isAdmin ? '<button class="admin-toggle" onclick="showAdminPanel()" style="font-size: 10px; padding: 4px 8px;">⚙️</button>' : ''}
                        </div>

                        <!-- Launch Modal Button -->
                        <button class="launch-modal-btn" onclick="openCopperModal()">
                            📊 Open Full Calculator
                        </button>

                        <!-- Quick Calculation in Sidebar -->
                        <div class="input-group">
                            <label>Product:</label>
                            <select id="sidebarProduct" onchange="updateSidebarResults()">
                                <option value="focus">${adminConfig.products.focus.name}</option>
                                <option value="release">${adminConfig.products.release.name}</option>
                                <option value="zoom">${adminConfig.products.zoom.name}</option>
                                <option value="mango">${adminConfig.products.mango.name}</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Master Cases:</label>
                            <input type="number" id="sidebarCases" value="28" min="1" max="500" onchange="updateSidebarResults()">
                        </div>

                        <!-- Quick Results -->
                        <div class="results">
                            <div id="sidebarResults" style="font-size: 12px;"></div>
                        </div>
                        
                        <!-- Admin Panel for Sidebar -->
                        ${isAdmin ? `
                        <div id="adminPanel" class="admin-panel">
                            <div class="admin-content">
                                <span class="admin-close" onclick="hideAdminPanel()">&times;</span>
                                <h2 style="color: #7cb342; text-align: center;">⚙️ Admin Settings</h2>
                                <p style="text-align: center; color: #666;">Configure pricing, tiers, and business rules</p>

                                <!-- Same admin content as above -->
                                <div class="admin-section">
                                    <h3>Product Pricing</h3>
                                    ${Object.keys(adminConfig.products).map(key => {
                                        const product = adminConfig.products[key];
                                        return `
                                            <div class="admin-grid">
                                                <div class="admin-field">
                                                    <label>${product.name} - Wholesale Price</label>
                                                    <input type="number" id="admin_${key}_price" step="0.01" min="0">
                                                </div>
                                                <div class="admin-field">
                                                    <label>${product.name} - MSRP</label>
                                                    <input type="number" id="admin_${key}_msrp" step="0.01" min="0">
                                                </div>
                                                <div class="admin-field">
                                                    <label>${product.name} - Units per Case</label>
                                                    <input type="number" id="admin_${key}_units" min="1">
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>

                                <div class="admin-section">
                                    <h3>Volume Tier Settings</h3>
                                    <div class="admin-grid">
                                        <div class="admin-field">
                                            <label>Tier 2 Threshold</label>
                                            <input type="number" id="admin_tier2_threshold" min="1">
                                        </div>
                                        <div class="admin-field">
                                            <label>Tier 2 Discount (%)</label>
                                            <input type="number" id="admin_tier2_discount" step="0.1" min="0" max="50">
                                        </div>
                                        <div class="admin-field">
                                            <label>Tier 3 Threshold</label>
                                            <input type="number" id="admin_tier3_threshold" min="1">
                                        </div>
                                        <div class="admin-field">
                                            <label>Tier 3 Discount (%)</label>
                                            <input type="number" id="admin_tier3_discount" step="0.1" min="0" max="50">
                                        </div>
                                    </div>
                                </div>

                                <div class="admin-section">
                                    <h3>Shipping & Payment</h3>
                                    <div class="admin-grid">
                                        <div class="admin-field">
                                            <label>Shipping Rate (%)</label>
                                            <input type="number" id="admin_shipping_rate" step="0.01" min="0" max="10">
                                        </div>
                                        <div class="admin-field">
                                            <label>Free Shipping Threshold</label>
                                            <input type="number" id="admin_free_shipping" min="0">
                                        </div>
                                        <div class="admin-field">
                                            <label>ACH Required Threshold</label>
                                            <input type="number" id="admin_ach_threshold" min="0">
                                        </div>
                                    </div>
                                </div>

                                <div class="admin-buttons">
                                    <button class="admin-btn admin-btn-save" onclick="saveAdminSettings()">💾 Save</button>
                                    <button class="admin-btn admin-btn-cancel" onclick="hideAdminPanel()">❌ Cancel</button>
                                    <button class="admin-btn admin-btn-reset" onclick="resetAdminSettings()">🔄 Reset</button>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                updateSidebarResults();
            }
        }

        // Load admin settings and initialize the app
        loadAdminSettings();
        renderApp();
    </script>
</body>
</html> + parseFloat(calc.shipping).toLocaleString()}</strong>${calc.freeShipping ? ' (Free shipping applied!)' : ''}</p>
                <p style="font-size: 18px; color: #7cb342;"><strong>💳 TOTAL: ${parseFloat(calc.total).toLocaleString()}</strong></p>
            `;

            if (document.getElementById('tierInfo')) {
                const tierClass = `tier${calc.tierInfo.name.split(' ')[1]}`;
                const savingsText = calc.tierInfo.discount > 0 ? ` (${(calc.tierInfo.discount * 100).toFixed(1)}% savings)` : '';
                const nextTierText = hasNextTier ? `<br><small>📈 Order ${nextTierThreshold}+ cases to qualify for ${calc.tierInfo.name === "Tier 1" ? "Tier 2" : "Tier 3"} pricing</small>` : '';

                document.getElementById('tierInfo').innerHTML = `
                    <strong class="pricing-tier ${tierClass}">${calc.tierInfo.name}</strong> pricing applied${savingsText}${nextTierText}
                `;
            }
        }

        function updateSidebarResults() {
            if (!document.getElementById('sidebarResults')) return;
            
            const productKey = document.getElementById('sidebarProduct').value;
            const masterCases = parseInt(document.getElementById('sidebarCases').value) || 0;
            const product = products[productKey];
            const tierInfo = getTier(masterCases);
            
            const unitPrice = product.price * (1 - tierInfo.discount);
            const total = (masterCases * unitPrice * product.unitsPerCase * 1.015).toFixed(0);
            
            document.getElementById('sidebarResults').innerHTML = `
                <p><strong>${product.name}</strong></p>
                <p>💰 <strong>$${unitPrice.toFixed(2)}</strong> per unit</p>
                <p>📦 <strong>${masterCases}</strong> Master Cases</p>
                <p style="color: #7cb342; font-weight: bold;">Total: $${parseInt(total).toLocaleString()}</p>
                <p style="font-size: 11px; color: #666;">${tierInfo.name} pricing</p>
            `;
        }

        function openCopperModal() {
            if (sdk && sdk.showModal) {
                sdk.showModal();
            } else {
                alert('Copper SDK not available. This feature requires running within Copper CRM.');
            }
        }

        function generateEmail() {
            const calc = calculateOrder();
            const prospectName = document.getElementById('prospectName').value || "[PROSPECT NAME]";
            const companyName = document.getElementById('companyName').value || "[COMPANY NAME]";
            const customerBase = document.getElementById('customerBase').value || "[CUSTOMER BASE]";
            const maxRetail = document.getElementById('maxRetail').value || "5.00";

            const email = `Subject: Partnership Proposal - ${calc.masterCases} Master Cases | ${companyName}

Hi ${prospectName},

Thank you for your interest in partnering with Kanva Botanicals! We're excited about the opportunity to work with you.

## Partnership Overview

We'd like to move forward with an initial ${calc.masterCases} Master Case order of ${calc.product.name}. Given your strong customer base in ${customerBase}, we believe this will be an excellent fit for both our businesses.

### Pricing Guidelines
To maintain market stability and ensure fair margins for all partners in your area, we ask that your retail price to customers not exceed **$${maxRetail}** per unit.

## Order Breakdown

**${calc.masterCases} Master Cases Contains:**
- ${calc.masterCases} Master Cases
- ${calc.displayBoxes} Display Boxes  
- ${calc.totalUnits.toLocaleString()} Individual Units

### ${calc.tierInfo.name} Wholesale Pricing:
- **Per Unit:** $${calc.unitPrice}
- **Per Master Case:** $${calc.casePrice}
- **Subtotal:** $${parseFloat(calc.subtotal).toLocaleString()}
- **Shipping & Handling:** $${parseFloat(calc.shipping).toLocaleString()}
- **TOTAL:** $${parseFloat(calc.total).toLocaleString()}

${calc.tierInfo.tier < 3 ? `*Note: Future orders of ${calc.tierInfo.tier === 1 ? '56' : '112'}+ Master Cases will qualify for improved pricing.*` : ''}

## Payment Information

${parseFloat(calc.total) >= 10000 ? 
`Since this order exceeds $10,000, payment will need to be processed via **ACH transfer**. I'll send over a DocuSign agreement that includes the ACH transfer details. Please provide a voided blank check for account verification.` : 
`Payment options: ACH transfer, wire transfer, or company check.`}

## Additional Product Opportunities

Our complete product line includes high-margin kratom capsules and powders (49-58% margins) that could be excellent additions for your experienced customers. Full catalog available upon request.

## Support Included
✅ **Retail Support** - In-store displays, POS materials, promotional strategies  
✅ **Sales Training** - Staff education and product knowledge support  
✅ **Marketing Assets** - Digital materials, window clings, branded displays  
✅ **Exclusive Offers** - Introductory pricing and promotional bundles  

## Next Steps

1. Review this proposal
2. Complete payment setup (DocuSign/ACH if applicable)
3. Schedule delivery once payment is processed

We're excited about building a successful partnership with you and supporting your business growth in the functional beverage market.

Please let me know if you have any questions or need any clarification on these terms.

Best regards,

[YOUR NAME]  
[YOUR TITLE]  
Kanva Botanicals  
[PHONE NUMBER]  
[EMAIL ADDRESS]`;

            document.getElementById('emailOutput').textContent = email;
            document.getElementById('emailTemplate').style.display = 'block';
            if (isModalMode) {
                document.getElementById('emailTemplate').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function copyEmail() {
            const emailText = document.getElementById('emailOutput').textContent;
            navigator.clipboard.writeText(emailText).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '✅ Copied!';
                btn.style.background = '#4caf50';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#7cb342';
                }, 2000);
            });
        }

        function saveQuoteToCRM() {
            const calc = calculateOrder();
            if (sdk && sdk.logActivity) {
                const details = `Quote Generated: ${calc.product.name} - ${calc.masterCases} Master Cases - $${parseFloat(calc.total).toLocaleString()}`;
                sdk.logActivity(0, details); // Activity Type 'note'
                alert('Quote saved to CRM activity log!');
            } else {
                alert(`Quote would be saved to CRM!\n\nProduct: ${calc.product.name}\nCases: ${calc.masterCases}\nTotal: $${parseFloat(calc.total).toLocaleString()}`);
            }
        }

        function createOpportunity() {
            const calc = calculateOrder();
            if (sdk && sdk.createEntity) {
                const opportunityData = {
                    name: `${calc.product.name} - ${calc.masterCases} MC`,
                    monetary_value: parseFloat(calc.total) * 100, // Convert to cents
                    details: `Quote: ${calc.masterCases} Master Cases of ${calc.product.name}`
                };
                sdk.createEntity('opportunity', opportunityData);
                alert('Opportunity created in Copper!');
            } else {
                alert(`Opportunity would be created!\n\nValue: $${parseFloat(calc.total).toLocaleString()}\nProduct: ${calc.product.name}\nStatus: Quote Sent`);
            }
        }

        function renderApp() {
            const appDiv = document.getElementById('app');
            
            if (isModalMode || isLeftNav) {
                // Full calculator interface (for both modal and left nav)
                appDiv.innerHTML = `
                    <div class="calculator">
                        <div class="header">
                            <h1>🌿 Kanva Botanicals Quote Calculator</h1>
                            <p>Professional quote generation with accurate pricing</p>
                            ${isLeftNav ? '<p style="color: #666; font-size: 14px;">Left Navigation Mode - Full Calculator</p>' : ''}
                        </div>

                        <!-- Customer Information -->
                        <h3>Customer Information</h3>
                        <div class="input-group">
                            <label>Prospect Name:</label>
                            <input type="text" id="prospectName" placeholder="Eddie">
                        </div>
                        <div class="input-group">
                            <label>Company Name:</label>
                            <input type="text" id="companyName" placeholder="ABC Distribution">
                        </div>
                        <div class="input-group">
                            <label>Customer Base:</label>
                            <input type="text" id="customerBase" placeholder="smoke and vape shops">
                        </div>

                        <!-- Product Selection -->
                        <h3>Product & Order Details</h3>
                        <div class="input-group">
                            <label>Primary Product:</label>
                            <select id="primaryProduct">
                                <option value="focus">Focus + Flow ($4.50)</option>
                                <option value="release">Release + Relax ($4.50)</option>
                                <option value="zoom">Kanva Zoom ($3.10)</option>
                                <option value="mango">Mango Extract ($4.25)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Master Cases:</label>
                            <input type="number" id="masterCases" value="28" min="1" max="500">
                        </div>
                        <div class="input-group">
                            <label>Max Retail Price:</label>
                            <input type="number" id="maxRetail" value="5.00" step="0.01" min="0">
                        </div>

                        <!-- Calculation Results -->
                        <div class="results">
                            <h3>Order Calculation</h3>
                            <div id="orderResults"></div>
                            <div id="tierInfo" class="tier-info"></div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap;">
                            <button class="copy-btn" onclick="generateEmail()">📧 Generate Quote Email</button>
                            <button class="copy-btn" onclick="saveQuoteToCRM()" style="background: #2196F3;">💾 Save to CRM</button>
                            <button class="copy-btn" onclick="createOpportunity()" style="background: #FF9800;">🎯 Create Opportunity</button>
                            ${isLeftNav ? '<button class="copy-btn" onclick="openCopperModal()" style="background: #9C27B0;">🔍 Open in Modal</button>' : ''}
                        </div>

                        <!-- Generated Email Template -->
                        <div id="emailTemplate" style="display: none; margin-top: 20px; background: white; border: 2px solid #7cb342; border-radius: 10px; padding: 25px;">
                            <h3>Generated Quote Email</h3>
                            <button class="copy-btn" onclick="copyEmail()">📋 Copy Email to Clipboard</button>
                            <div id="emailOutput"></div>
                        </div>

                        <!-- Product Reference -->
                        <h3>Quick Product Reference</h3>
                        <div class="product-grid">
                            <div class="product-card">
                                <h4>2oz Wellness Shots</h4>
                                <p><strong>Focus + Flow:</strong> $4.50 → $9.99 MSRP <span class="pricing-tier tier1">10% margin</span></p>
                                <p><strong>Release + Relax:</strong> $4.50 → $9.99 MSRP <span class="pricing-tier tier1">10% margin</span></p>
                                <p><strong>Raw + Releaf:</strong> <em>Coming Soon</em></p>
                            </div>
                            <div class="product-card">
                                <h4>Energy & Extract Shots</h4>
                                <p><strong>Kanva Zoom:</strong> $3.10 → $6.99 MSRP <span class="pricing-tier tier1">11.43% margin</span></p>
                                <p><strong>Mango Extract:</strong> $4.25 → $9.99 MSRP <span class="pricing-tier tier2">15% margin</span></p>
                            </div>
                            <div class="product-card">
                                <h4>High-Margin Products</h4>
                                <p><strong>Kratom Capsules:</strong> 49-58% margins <span class="pricing-tier tier3">High Profit</span></p>
                                <p><strong>Kratom Powders:</strong> 49-56% margins <span class="pricing-tier tier3">High Profit</span></p>
                                <p><em>Perfect add-ons for experienced customers</em></p>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add event listeners for full calculator
                document.getElementById('masterCases').addEventListener('input', updateResults);
                document.getElementById('primaryProduct').addEventListener('change', updateResults);
                updateResults();
            } else {
                // Compact sidebar interface (only for sidebar placement)
                appDiv.innerHTML = `
                    <div class="calculator sidebar-mode">
                        <div class="header" style="text-align: center; margin-bottom: 15px;">
                            <h3 style="color: #7cb342; margin: 0; font-size: 16px;">🌿 Kanva Calculator</h3>
                        </div>

                        <!-- Launch Modal Button -->
                        <button class="launch-modal-btn" onclick="openCopperModal()">
                            📊 Open Full Calculator
                        </button>

                        <!-- Quick Calculation in Sidebar -->
                        <div class="input-group">
                            <label>Product:</label>
                            <select id="sidebarProduct" onchange="updateSidebarResults()">
                                <option value="focus">Focus + Flow</option>
                                <option value="release">Release + Relax</option>
                                <option value="zoom">Kanva Zoom</option>
                                <option value="mango">Mango Extract</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Master Cases:</label>
                            <input type="number" id="sidebarCases" value="28" min="1" max="500" onchange="updateSidebarResults()">
                        </div>

                        <!-- Quick Results -->
                        <div class="results">
                            <div id="sidebarResults" style="font-size: 12px;"></div>
                        </div>
                    </div>
                `;
                
                updateSidebarResults();
            }
        }

        // Initialize the app
        renderApp();
    </script>
</body>
</html> + parseFloat(calc.shipping).toLocaleString()}${calc.freeShipping ? ' (Free shipping applied!)' : ''}
- **TOTAL:** ${parseFloat(calc.total).toLocaleString()}

${calc.tierInfo.name !== "Tier 3" ? `*Note: Future orders of ${calc.tierInfo.name === "Tier 1" ? adminConfig.tiers.tier2.threshold : adminConfig.tiers.tier3.threshold}+ Master Cases will qualify for improved pricing.*` : ''}

## Payment Information

${parseFloat(calc.total) >= adminConfig.payment.achThreshold ? 
`Since this order exceeds ${adminConfig.payment.achThreshold.toLocaleString()}, payment will need to be processed via **ACH transfer**. I'll send over a DocuSign agreement that includes the ACH transfer details. Please provide a voided blank check for account verification.` : 
`Payment options: ACH transfer, wire transfer, or company check.`}

## Additional Product Opportunities

Our complete product line includes high-margin kratom capsules and powders (49-58% margins) that could be excellent additions for your experienced customers. Full catalog available upon request.

## Support Included
✅ **Retail Support** - In-store displays, POS materials, promotional strategies  
✅ **Sales Training** - Staff education and product knowledge support  
✅ **Marketing Assets** - Digital materials, window clings, branded displays  
✅ **Exclusive Offers** - Introductory pricing and promotional bundles  

## Next Steps

1. Review this proposal
2. Complete payment setup (DocuSign/ACH if applicable)
3. Schedule delivery once payment is processed

We're excited about building a successful partnership with you and supporting your business growth in the functional beverage market.

Please let me know if you have any questions or need any clarification on these terms.

Best regards,

[YOUR NAME]  
[YOUR TITLE]  
Kanva Botanicals  
[PHONE NUMBER]  
[EMAIL ADDRESS]`;

            document.getElementById('emailOutput').textContent = email;
            document.getElementById('emailTemplate').style.display = 'block';
            if (isModalMode) {
                document.getElementById('emailTemplate').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function copyEmail() {
            const emailText = document.getElementById('emailOutput').textContent;
            navigator.clipboard.writeText(emailText).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '✅ Copied!';
                btn.style.background = '#4caf50';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#7cb342';
                }, 2000);
            });
        }

        function saveQuoteToCRM() {
            const calc = calculateOrder();
            if (sdk && sdk.logActivity) {
                const details = `Quote Generated: ${calc.product.name} - ${calc.masterCases} Master Cases - $${parseFloat(calc.total).toLocaleString()}`;
                sdk.logActivity(0, details); // Activity Type 'note'
                alert('Quote saved to CRM activity log!');
            } else {
                alert(`Quote would be saved to CRM!\n\nProduct: ${calc.product.name}\nCases: ${calc.masterCases}\nTotal: $${parseFloat(calc.total).toLocaleString()}`);
            }
        }

        function createOpportunity() {
            const calc = calculateOrder();
            if (sdk && sdk.createEntity) {
                const opportunityData = {
                    name: `${calc.product.name} - ${calc.masterCases} MC`,
                    monetary_value: parseFloat(calc.total) * 100, // Convert to cents
                    details: `Quote: ${calc.masterCases} Master Cases of ${calc.product.name}`
                };
                sdk.createEntity('opportunity', opportunityData);
                alert('Opportunity created in Copper!');
            } else {
                alert(`Opportunity would be created!\n\nValue: $${parseFloat(calc.total).toLocaleString()}\nProduct: ${calc.product.name}\nStatus: Quote Sent`);
            }
        }

        function renderApp() {
            const appDiv = document.getElementById('app');
            
            if (isModalMode || isLeftNav) {
                // Full calculator interface (for both modal and left nav)
                appDiv.innerHTML = `
                    <div class="calculator">
                        <div class="header">
                            <h1>🌿 Kanva Botanicals Quote Calculator</h1>
                            <p>Professional quote generation with accurate pricing</p>
                            ${isLeftNav ? '<p style="color: #666; font-size: 14px;">Left Navigation Mode - Full Calculator</p>' : ''}
                        </div>

                        <!-- Customer Information -->
                        <h3>Customer Information</h3>
                        <div class="input-group">
                            <label>Prospect Name:</label>
                            <input type="text" id="prospectName" placeholder="Eddie">
                        </div>
                        <div class="input-group">
                            <label>Company Name:</label>
                            <input type="text" id="companyName" placeholder="ABC Distribution">
                        </div>
                        <div class="input-group">
                            <label>Customer Base:</label>
                            <input type="text" id="customerBase" placeholder="smoke and vape shops">
                        </div>

                        <!-- Product Selection -->
                        <h3>Product & Order Details</h3>
                        <div class="input-group">
                            <label>Primary Product:</label>
                            <select id="primaryProduct">
                                <option value="focus">Focus + Flow ($4.50)</option>
                                <option value="release">Release + Relax ($4.50)</option>
                                <option value="zoom">Kanva Zoom ($3.10)</option>
                                <option value="mango">Mango Extract ($4.25)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Master Cases:</label>
                            <input type="number" id="masterCases" value="28" min="1" max="500">
                        </div>
                        <div class="input-group">
                            <label>Max Retail Price:</label>
                            <input type="number" id="maxRetail" value="5.00" step="0.01" min="0">
                        </div>

                        <!-- Calculation Results -->
                        <div class="results">
                            <h3>Order Calculation</h3>
                            <div id="orderResults"></div>
                            <div id="tierInfo" class="tier-info"></div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap;">
                            <button class="copy-btn" onclick="generateEmail()">📧 Generate Quote Email</button>
                            <button class="copy-btn" onclick="saveQuoteToCRM()" style="background: #2196F3;">💾 Save to CRM</button>
                            <button class="copy-btn" onclick="createOpportunity()" style="background: #FF9800;">🎯 Create Opportunity</button>
                            ${isLeftNav ? '<button class="copy-btn" onclick="openCopperModal()" style="background: #9C27B0;">🔍 Open in Modal</button>' : ''}
                        </div>

                        <!-- Generated Email Template -->
                        <div id="emailTemplate" style="display: none; margin-top: 20px; background: white; border: 2px solid #7cb342; border-radius: 10px; padding: 25px;">
                            <h3>Generated Quote Email</h3>
                            <button class="copy-btn" onclick="copyEmail()">📋 Copy Email to Clipboard</button>
                            <div id="emailOutput"></div>
                        </div>

                        <!-- Product Reference -->
                        <h3>Quick Product Reference</h3>
                        <div class="product-grid">
                            <div class="product-card">
                                <h4>2oz Wellness Shots</h4>
                                <p><strong>Focus + Flow:</strong> $4.50 → $9.99 MSRP <span class="pricing-tier tier1">10% margin</span></p>
                                <p><strong>Release + Relax:</strong> $4.50 → $9.99 MSRP <span class="pricing-tier tier1">10% margin</span></p>
                                <p><strong>Raw + Releaf:</strong> <em>Coming Soon</em></p>
                            </div>
                            <div class="product-card">
                                <h4>Energy & Extract Shots</h4>
                                <p><strong>Kanva Zoom:</strong> $3.10 → $6.99 MSRP <span class="pricing-tier tier1">11.43% margin</span></p>
                                <p><strong>Mango Extract:</strong> $4.25 → $9.99 MSRP <span class="pricing-tier tier2">15% margin</span></p>
                            </div>
                            <div class="product-card">
                                <h4>High-Margin Products</h4>
                                <p><strong>Kratom Capsules:</strong> 49-58% margins <span class="pricing-tier tier3">High Profit</span></p>
                                <p><strong>Kratom Powders:</strong> 49-56% margins <span class="pricing-tier tier3">High Profit</span></p>
                                <p><em>Perfect add-ons for experienced customers</em></p>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add event listeners for full calculator
                document.getElementById('masterCases').addEventListener('input', updateResults);
                document.getElementById('primaryProduct').addEventListener('change', updateResults);
                updateResults();
            } else {
                // Compact sidebar interface (only for sidebar placement)
                appDiv.innerHTML = `
                    <div class="calculator sidebar-mode">
                        <div class="header" style="text-align: center; margin-bottom: 15px;">
                            <h3 style="color: #7cb342; margin: 0; font-size: 16px;">🌿 Kanva Calculator</h3>
                        </div>

                        <!-- Launch Modal Button -->
                        <button class="launch-modal-btn" onclick="openCopperModal()">
                            📊 Open Full Calculator
                        </button>

                        <!-- Quick Calculation in Sidebar -->
                        <div class="input-group">
                            <label>Product:</label>
                            <select id="sidebarProduct" onchange="updateSidebarResults()">
                                <option value="focus">Focus + Flow</option>
                                <option value="release">Release + Relax</option>
                                <option value="zoom">Kanva Zoom</option>
                                <option value="mango">Mango Extract</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Master Cases:</label>
                            <input type="number" id="sidebarCases" value="28" min="1" max="500" onchange="updateSidebarResults()">
                        </div>

                        <!-- Quick Results -->
                        <div class="results">
                            <div id="sidebarResults" style="font-size: 12px;"></div>
                        </div>
                    </div>
                `;
                
                updateSidebarResults();
            }
        }

        // Initialize the app
        renderApp();
    </script>
</body>
</html> + parseFloat(calc.shipping).toLocaleString()}</strong>${calc.freeShipping ? ' (Free shipping applied!)' : ''}</p>
                <p style="font-size: 18px; color: #7cb342;"><strong>💳 TOTAL: ${parseFloat(calc.total).toLocaleString()}</strong></p>
            `;

            if (document.getElementById('tierInfo')) {
                const tierClass = `tier${calc.tierInfo.name.split(' ')[1]}`;
                const savingsText = calc.tierInfo.discount > 0 ? ` (${(calc.tierInfo.discount * 100).toFixed(1)}% savings)` : '';
                const nextTierText = hasNextTier ? `<br><small>📈 Order ${nextTierThreshold}+ cases to qualify for ${calc.tierInfo.name === "Tier 1" ? "Tier 2" : "Tier 3"} pricing</small>` : '';

                document.getElementById('tierInfo').innerHTML = `
                    <strong class="pricing-tier ${tierClass}">${calc.tierInfo.name}</strong> pricing applied${savingsText}${nextTierText}
                `;
            }
        }

        function updateSidebarResults() {
            if (!document.getElementById('sidebarResults')) return;
            
            const productKey = document.getElementById('sidebarProduct').value;
            const masterCases = parseInt(document.getElementById('sidebarCases').value) || 0;
            const product = products[productKey];
            const tierInfo = getTier(masterCases);
            
            const unitPrice = product.price * (1 - tierInfo.discount);
            const total = (masterCases * unitPrice * product.unitsPerCase * 1.015).toFixed(0);
            
            document.getElementById('sidebarResults').innerHTML = `
                <p><strong>${product.name}</strong></p>
                <p>💰 <strong>$${unitPrice.toFixed(2)}</strong> per unit</p>
                <p>📦 <strong>${masterCases}</strong> Master Cases</p>
                <p style="color: #7cb342; font-weight: bold;">Total: $${parseInt(total).toLocaleString()}</p>
                <p style="font-size: 11px; color: #666;">${tierInfo.name} pricing</p>
            `;
        }

        function openCopperModal() {
            if (sdk && sdk.showModal) {
                sdk.showModal();
            } else {
                alert('Copper SDK not available. This feature requires running within Copper CRM.');
            }
        }

        function generateEmail() {
            const calc = calculateOrder();
            const prospectName = document.getElementById('prospectName').value || "[PROSPECT NAME]";
            const companyName = document.getElementById('companyName').value || "[COMPANY NAME]";
            const customerBase = document.getElementById('customerBase').value || "[CUSTOMER BASE]";
            const maxRetail = document.getElementById('maxRetail').value || "5.00";

            const email = `Subject: Partnership Proposal - ${calc.masterCases} Master Cases | ${companyName}

Hi ${prospectName},

Thank you for your interest in partnering with Kanva Botanicals! We're excited about the opportunity to work with you.

## Partnership Overview

We'd like to move forward with an initial ${calc.masterCases} Master Case order of ${calc.product.name}. Given your strong customer base in ${customerBase}, we believe this will be an excellent fit for both our businesses.

### Pricing Guidelines
To maintain market stability and ensure fair margins for all partners in your area, we ask that your retail price to customers not exceed **$${maxRetail}** per unit.

## Order Breakdown

**${calc.masterCases} Master Cases Contains:**
- ${calc.masterCases} Master Cases
- ${calc.displayBoxes} Display Boxes  
- ${calc.totalUnits.toLocaleString()} Individual Units

### ${calc.tierInfo.name} Wholesale Pricing:
- **Per Unit:** $${calc.unitPrice}
- **Per Master Case:** $${calc.casePrice}
- **Subtotal:** $${parseFloat(calc.subtotal).toLocaleString()}
- **Shipping & Handling:** $${parseFloat(calc.shipping).toLocaleString()}
- **TOTAL:** $${parseFloat(calc.total).toLocaleString()}

${calc.tierInfo.tier < 3 ? `*Note: Future orders of ${calc.tierInfo.tier === 1 ? '56' : '112'}+ Master Cases will qualify for improved pricing.*` : ''}

## Payment Information

${parseFloat(calc.total) >= 10000 ? 
`Since this order exceeds $10,000, payment will need to be processed via **ACH transfer**. I'll send over a DocuSign agreement that includes the ACH transfer details. Please provide a voided blank check for account verification.` : 
`Payment options: ACH transfer, wire transfer, or company check.`}

## Additional Product Opportunities

Our complete product line includes high-margin kratom capsules and powders (49-58% margins) that could be excellent additions for your experienced customers. Full catalog available upon request.

## Support Included
✅ **Retail Support** - In-store displays, POS materials, promotional strategies  
✅ **Sales Training** - Staff education and product knowledge support  
✅ **Marketing Assets** - Digital materials, window clings, branded displays  
✅ **Exclusive Offers** - Introductory pricing and promotional bundles  

## Next Steps

1. Review this proposal
2. Complete payment setup (DocuSign/ACH if applicable)
3. Schedule delivery once payment is processed

We're excited about building a successful partnership with you and supporting your business growth in the functional beverage market.

Please let me know if you have any questions or need any clarification on these terms.

Best regards,

[YOUR NAME]  
[YOUR TITLE]  
Kanva Botanicals  
[PHONE NUMBER]  
[EMAIL ADDRESS]`;

            document.getElementById('emailOutput').textContent = email;
            document.getElementById('emailTemplate').style.display = 'block';
            if (isModalMode) {
                document.getElementById('emailTemplate').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function copyEmail() {
            const emailText = document.getElementById('emailOutput').textContent;
            navigator.clipboard.writeText(emailText).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '✅ Copied!';
                btn.style.background = '#4caf50';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#7cb342';
                }, 2000);
            });
        }

        function saveQuoteToCRM() {
            const calc = calculateOrder();
            if (sdk && sdk.logActivity) {
                const details = `Quote Generated: ${calc.product.name} - ${calc.masterCases} Master Cases - $${parseFloat(calc.total).toLocaleString()}`;
                sdk.logActivity(0, details); // Activity Type 'note'
                alert('Quote saved to CRM activity log!');
            } else {
                alert(`Quote would be saved to CRM!\n\nProduct: ${calc.product.name}\nCases: ${calc.masterCases}\nTotal: $${parseFloat(calc.total).toLocaleString()}`);
            }
        }

        function createOpportunity() {
            const calc = calculateOrder();
            if (sdk && sdk.createEntity) {
                const opportunityData = {
                    name: `${calc.product.name} - ${calc.masterCases} MC`,
                    monetary_value: parseFloat(calc.total) * 100, // Convert to cents
                    details: `Quote: ${calc.masterCases} Master Cases of ${calc.product.name}`
                };
                sdk.createEntity('opportunity', opportunityData);
                alert('Opportunity created in Copper!');
            } else {
                alert(`Opportunity would be created!\n\nValue: $${parseFloat(calc.total).toLocaleString()}\nProduct: ${calc.product.name}\nStatus: Quote Sent`);
            }
        }

        function renderApp() {
            const appDiv = document.getElementById('app');
            
            if (isModalMode || isLeftNav) {
                // Full calculator interface (for both modal and left nav)
                appDiv.innerHTML = `
                    <div class="calculator">
                        <div class="header">
                            <h1>🌿 Kanva Botanicals Quote Calculator</h1>
                            <p>Professional quote generation with accurate pricing</p>
                            ${isLeftNav ? '<p style="color: #666; font-size: 14px;">Left Navigation Mode - Full Calculator</p>' : ''}
                        </div>

                        <!-- Customer Information -->
                        <h3>Customer Information</h3>
                        <div class="input-group">
                            <label>Prospect Name:</label>
                            <input type="text" id="prospectName" placeholder="Eddie">
                        </div>
                        <div class="input-group">
                            <label>Company Name:</label>
                            <input type="text" id="companyName" placeholder="ABC Distribution">
                        </div>
                        <div class="input-group">
                            <label>Customer Base:</label>
                            <input type="text" id="customerBase" placeholder="smoke and vape shops">
                        </div>

                        <!-- Product Selection -->
                        <h3>Product & Order Details</h3>
                        <div class="input-group">
                            <label>Primary Product:</label>
                            <select id="primaryProduct">
                                <option value="focus">Focus + Flow ($4.50)</option>
                                <option value="release">Release + Relax ($4.50)</option>
                                <option value="zoom">Kanva Zoom ($3.10)</option>
                                <option value="mango">Mango Extract ($4.25)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Master Cases:</label>
                            <input type="number" id="masterCases" value="28" min="1" max="500">
                        </div>
                        <div class="input-group">
                            <label>Max Retail Price:</label>
                            <input type="number" id="maxRetail" value="5.00" step="0.01" min="0">
                        </div>

                        <!-- Calculation Results -->
                        <div class="results">
                            <h3>Order Calculation</h3>
                            <div id="orderResults"></div>
                            <div id="tierInfo" class="tier-info"></div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap;">
                            <button class="copy-btn" onclick="generateEmail()">📧 Generate Quote Email</button>
                            <button class="copy-btn" onclick="saveQuoteToCRM()" style="background: #2196F3;">💾 Save to CRM</button>
                            <button class="copy-btn" onclick="createOpportunity()" style="background: #FF9800;">🎯 Create Opportunity</button>
                            ${isLeftNav ? '<button class="copy-btn" onclick="openCopperModal()" style="background: #9C27B0;">🔍 Open in Modal</button>' : ''}
                        </div>

                        <!-- Generated Email Template -->
                        <div id="emailTemplate" style="display: none; margin-top: 20px; background: white; border: 2px solid #7cb342; border-radius: 10px; padding: 25px;">
                            <h3>Generated Quote Email</h3>
                            <button class="copy-btn" onclick="copyEmail()">📋 Copy Email to Clipboard</button>
                            <div id="emailOutput"></div>
                        </div>

                        <!-- Product Reference -->
                        <h3>Quick Product Reference</h3>
                        <div class="product-grid">
                            <div class="product-card">
                                <h4>2oz Wellness Shots</h4>
                                <p><strong>Focus + Flow:</strong> $4.50 → $9.99 MSRP <span class="pricing-tier tier1">10% margin</span></p>
                                <p><strong>Release + Relax:</strong> $4.50 → $9.99 MSRP <span class="pricing-tier tier1">10% margin</span></p>
                                <p><strong>Raw + Releaf:</strong> <em>Coming Soon</em></p>
                            </div>
                            <div class="product-card">
                                <h4>Energy & Extract Shots</h4>
                                <p><strong>Kanva Zoom:</strong> $3.10 → $6.99 MSRP <span class="pricing-tier tier1">11.43% margin</span></p>
                                <p><strong>Mango Extract:</strong> $4.25 → $9.99 MSRP <span class="pricing-tier tier2">15% margin</span></p>
                            </div>
                            <div class="product-card">
                                <h4>High-Margin Products</h4>
                                <p><strong>Kratom Capsules:</strong> 49-58% margins <span class="pricing-tier tier3">High Profit</span></p>
                                <p><strong>Kratom Powders:</strong> 49-56% margins <span class="pricing-tier tier3">High Profit</span></p>
                                <p><em>Perfect add-ons for experienced customers</em></p>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add event listeners for full calculator
                document.getElementById('masterCases').addEventListener('input', updateResults);
                document.getElementById('primaryProduct').addEventListener('change', updateResults);
                updateResults();
            } else {
                // Compact sidebar interface (only for sidebar placement)
                appDiv.innerHTML = `
                    <div class="calculator sidebar-mode">
                        <div class="header" style="text-align: center; margin-bottom: 15px;">
                            <h3 style="color: #7cb342; margin: 0; font-size: 16px;">🌿 Kanva Calculator</h3>
                        </div>

                        <!-- Launch Modal Button -->
                        <button class="launch-modal-btn" onclick="openCopperModal()">
                            📊 Open Full Calculator
                        </button>

                        <!-- Quick Calculation in Sidebar -->
                        <div class="input-group">
                            <label>Product:</label>
                            <select id="sidebarProduct" onchange="updateSidebarResults()">
                                <option value="focus">Focus + Flow</option>
                                <option value="release">Release + Relax</option>
                                <option value="zoom">Kanva Zoom</option>
                                <option value="mango">Mango Extract</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Master Cases:</label>
                            <input type="number" id="sidebarCases" value="28" min="1" max="500" onchange="updateSidebarResults()">
                        </div>

                        <!-- Quick Results -->
                        <div class="results">
                            <div id="sidebarResults" style="font-size: 12px;"></div>
                        </div>
                    </div>
                `;
                
                updateSidebarResults();
            }
        }

        // Initialize the app
        renderApp();
    </script>
</body>
</html>
