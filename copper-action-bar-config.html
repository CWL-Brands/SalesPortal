<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/copper-sdk@latest/dist/copper-sdk.min.js"></script>
    <script type="text/javascript">
        console.log('üîß Copper Action Bar Advanced Configuration loading...');
        
        // Initialize Copper SDK
        var sdk = window.Copper.init();
        
        // Configure Action Bar UI
        sdk.setAppUI({
            width: 50,  // Small width for action bar icon
            height: 50, // Small height for action bar icon
            disableAddButton: true,
            showActionBar: true,
            isActionBarActive: false
        });
        
        console.log('‚úÖ Action Bar configured');
        
        // Get context and launch modal when action bar is clicked
        function launchQuoteModal() {
            console.log('üöÄ Action Bar clicked - launching quote modal...');
            
            sdk.getContext()
                .then(function(data) {
                    console.log('üìã Context retrieved:', data);
                    
                    // Extract customer data from context
                    var params = {};
                    if (data && data.context && data.context.entity) {
                        var entity = data.context.entity;
                        params = {
                            customer_id: entity.id,
                            company: entity.name || entity.company_name || '',
                            email: entity.email || '',
                            phone: entity.phone_number || '',
                            address: entity.address ? 
                                (entity.address.street + ', ' + entity.address.city + ', ' + entity.address.state).trim() : ''
                        };
                        console.log('üéØ Customer data extracted:', params);
                    }
                    
                    // Launch modal with customer context
                    console.log('üöÄ Launching modal with context...');
                    sdk.showModal(params);
                })
                .catch(function(error) {
                    console.warn('‚ö†Ô∏è Error getting context, launching modal without it:', error);
                    sdk.showModal({});
                });
        }
        
        // Auto-launch modal when this action bar item loads
        // This makes the action bar icon immediately launch the modal when clicked
        setTimeout(function() {
            launchQuoteModal();
        }, 100);
        
    </script>
</head>
<body style="margin: 0; padding: 0; width: 50px; height: 50px; background: transparent;">
    <!-- Action Bar Icon Content -->
    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="launchQuoteModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2Z" stroke="#6366f1" stroke-width="2" fill="#f0f9ff"/>
            <path d="M14 2V8H20" stroke="#6366f1" stroke-width="2" fill="none"/>
            <path d="M16 13H8" stroke="#6366f1" stroke-width="2"/>
            <path d="M16 17H8" stroke="#6366f1" stroke-width="2"/>
            <path d="M10 9H9H8" stroke="#6366f1" stroke-width="2"/>
        </svg>
    </div>
</body>
</html>
